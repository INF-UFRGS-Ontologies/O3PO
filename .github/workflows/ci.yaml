name: Updates Website on New Release

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  release:
    types: [published]

jobs:
  deploy:
    name: FIle transfer for the ontologies website
    runs-on: arc-runner

    env:
      # For future ontologies it will only be necessary to change here
      ONTOLOGY: o3po
      REMOTE_BASE_PATH: ../ontologies/public_html/


    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ› ï¸ Process Release Name
        run: |
          RAW_NAME="${{ github.event.release.name || 'manual' }}"
          
          CLEAN_NAME="${RAW_NAME#v}"
          
          if [[ "$CLEAN_NAME" =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
            echo "FINAL_RELEASE_NAME=$CLEAN_NAME" >> $GITHUB_ENV
            echo "Using release name: $CLEAN_NAME"
          else
            # if the release name format isn't the one expected
            FALLBACK_DATE=$(date +%Y-%m-%d)
            echo "FINAL_RELEASE_NAME=$FALLBACK_DATE" >> $GITHUB_ENV
            echo "Format mismatch or manual run. Using date: $FALLBACK_DATE"
          fi
          
      - name: Transfer all files into release
        uses: Dylan700/sftp-upload-action@latest 
        with:
          server: 143.54.11.25
          username: ontokg
          password: ${{ secrets.FTP }}
          port: 22
          
          uploads: |
            ./ => ${{env.REMOTE_BASE_PATH}}${{env.ONTOLOGY}}/releases/${{env.FINAL_RELEASE_NAME}}/
          ignore: |
            .git*
            src
            .github/workflows
            *.md
            LICENSE

      - name: Transfer main ontology to ontologies folder
        uses: Dylan700/sftp-upload-action@latest 
        with:
          server: 143.54.11.25
          username: ontokg
          password: ${{ secrets.FTP }}
          port: 22
          
          uploads: |
            ./ => ${{env.REMOTE_BASE_PATH}}
          ignore: |
            !${{env.ONTOLOGY}}.owl
            
      - name: Transfer main ontology to ontologies folder
        uses: Dylan700/sftp-upload-action@latest 
        with:
          server: 143.54.11.25
          username: ontokg
          password: ${{ secrets.FTP }}
          port: 22
          
          uploads: |
            ./ => ${{env.REMOTE_BASE_PATH}}
          ignore: |
            !${{env.ONTOLOGY}}.ttl
            
      - name: Transfering full
        uses: Dylan700/sftp-upload-action@latest 
        with:
          server: 143.54.11.25
          username: ontokg
          password: ${{ secrets.FTP }}
          port: 22
          
          uploads: |
            ./ => ${{env.REMOTE_BASE_PATH}}${{env.ONTOLOGY}}/
          ignore: |
            .git*
            src
            *.md
            LICENSE
            ${{env.ONTOLOGY}}.ttl
            ${{env.ONTOLOGY}}.owl
